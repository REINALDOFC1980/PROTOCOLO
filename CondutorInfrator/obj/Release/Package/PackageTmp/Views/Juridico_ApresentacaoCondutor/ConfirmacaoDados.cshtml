@model CondutorInfrator.Models.ProcessoViewModel 

@{
    var claimsIdentity = User.Identity as System.Security.Claims.ClaimsIdentity;
    var Pes_TipoPessoa = claimsIdentity.FindFirst(System.Security.Claims.ClaimTypes.Role).Value;
}

@using (Html.BeginForm("", "", FormMethod.Post, new { id = "form", name = "form" }))
{
    <div class="container">
        <div class="conteudo">
            <div class="row">
                <div class="col-md-11" style="margin-left:-28px; font-style: italic">
                    <h5> <img src="~/img/Assitente.png" style="margin-left:20px;" /> <strong> Analise se todos os dados descritos no formulário abaixo estão corretos e confirme. </strong></h5>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-9">
                    <h3>PJ - Confirmação dos Dados</h3>
                </div>
                <div class="col-md-3 text-right text-danger" style="font-style: italic">
                    <h5>
                        <img src="~/img/Assitente (1).png" />  <strong>Mais informações? @Html.ActionLink("Clique aqui!", "informacao_importante", "pessoa")</strong>
                    </h5>
                </div>
            </div>
            <br />
            <div class="row">
                <div class="col-md-6">
                    <h3>Informações do Condutor Infrator</h3>
                    <table class="table table-borderless">
                        <tbody>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_CPF)</th>
                                <td>@Html.DisplayFor(model => model.Con_CPF, new { htmlAttributes = new { @class = "form-control", id = "Con_CPF" } })</td>
                                @Html.HiddenFor(model => model.Con_CPF)
                                @Html.HiddenFor(model => model.Con_ConfirmarAceite)
                                @Html.HiddenFor(model => model.Con_Cadastrado)
                                @Html.HiddenFor(model => model.Con_Estrangeiro)
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_Nome)</th>
                                <td>@Html.DisplayFor(model => model.Con_Nome, new { htmlAttributes = new { @class = "form-control", id = "Con_Nome" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_Nome)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_RegistroCNH)</th>
                                <td>@Html.DisplayFor(model => model.Con_RegistroCNH, new { htmlAttributes = new { @class = "form-control", id = "Con_RegistroCNH" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_RegistroCNH)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_CNHValidade)</th>
                                <td>@Html.DisplayFor(model => model.Con_CNHValidade, new { htmlAttributes = new { @class = "form-control", id = "Con_CNHValidade" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_CNHValidade)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_UF_CNH)</th>
                                <td>@Html.DisplayFor(model => model.Con_UF_CNH, new { htmlAttributes = new { @class = "form-control", id = "Con_UF_CNH" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_UF_CNH)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_EndPro_CEP)</th>
                                <td>@Html.DisplayFor(model => model.Con_EndPro_CEP, new { htmlAttributes = new { @class = "form-control", id = "Con_EndPro_CEP" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_EndPro_CEP)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_EndPro_Logradouro)</th>
                                <td>@Html.DisplayFor(model => model.Con_EndPro_Logradouro, new { htmlAttributes = new { @class = "form-control", id = "Con_EndPro_Logradouro" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_EndPro_Logradouro)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_EndPro_Bairro)</th>
                                <td>@Html.DisplayFor(model => model.Con_EndPro_Bairro, new { htmlAttributes = new { @class = "form-control", id = "Con_EndPro_Bairro" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_EndPro_Bairro)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_EndPro_Complemento)</th>
                                <td>@Html.DisplayFor(model => model.Con_EndPro_Complemento, new { htmlAttributes = new { @class = "form-control", id = "Con_EndPro_Complemento" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_EndPro_Complemento)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_EndPro_Cidade)</th>
                                <td>@Html.DisplayFor(model => model.Con_EndPro_Cidade, new { htmlAttributes = new { @class = "form-control", id = "Con_EndPro_Cidade" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_EndPro_Cidade)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_EndPro_Estado)</th>
                                <td>@Html.DisplayFor(model => model.Con_EndPro_Estado, new { htmlAttributes = new { @class = "form-control", id = "Con_EndPro_Estado" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_EndPro_Estado)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_EndPro_Pais)</th>
                                <td>@Html.DisplayFor(model => model.Con_EndPro_Pais, new { htmlAttributes = new { @class = "form-control", id = "Con_EndPro_Pais" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_EndPro_Pais)</td>
                            </tr>

                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_Telefone)</th>
                                <td>@Html.DisplayFor(model => model.Con_Telefone, new { htmlAttributes = new { @class = "form-control", id = "Con_Telefone" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_Telefone)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Con_Email)</th>
                                <td>@Html.DisplayFor(model => model.Con_Email, new { htmlAttributes = new { @class = "form-control", id = "Con_Email" } })</td>
                                <td>@Html.HiddenFor(model => model.Con_Email)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h3>Informações do Requerente</h3>
                    <table class="table table-borderless">
                        <tbody>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_CPF_CNPJ)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_CPF_CNPJ, new { htmlAttributes = new { @class = "form-control", id = "Ptr_CPF_CNPJ" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_CPF_CNPJ)</td>

                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_Nome)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_Nome, new { htmlAttributes = new { @class = "form-control", id = "Ptr_Nome" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_Nome)</td>
                            </tr>


                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_EndPro_CEP)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_EndPro_CEP, new { htmlAttributes = new { @class = "form-control", id = "Ptr_EndPro_CEP" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_EndPro_CEP)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_EndPro_Logradouro)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_EndPro_Logradouro, new { htmlAttributes = new { @class = "form-control", id = "Ptr_EndPro_Logradouro" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_EndPro_Logradouro)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_EndPro_Bairro)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_EndPro_Bairro, new { htmlAttributes = new { @class = "form-control", id = "Ptr_EndPro_Bairro" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_EndPro_Bairro)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_EndPro_Complemento)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_EndPro_Complemento, new { htmlAttributes = new { @class = "form-control", id = "Ptr_EndPro_Complemento" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_EndPro_Complemento)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_EndPro_Cidade)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_EndPro_Cidade, new { htmlAttributes = new { @class = "form-control", id = "Ptr_EndPro_Cidade" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_EndPro_Cidade)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_EndPro_Estado)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_EndPro_Estado, new { htmlAttributes = new { @class = "form-control", id = "Ptr_EndPro_Estado" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_EndPro_Estado)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_EndPro_Pais)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_EndPro_Pais, new { htmlAttributes = new { @class = "form-control", id = "Ptr_EndPro_Pais" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_EndPro_Pais)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_Telefone)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_Telefone, new { htmlAttributes = new { @class = "form-control", id = "Ptr_Telefone" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_Telefone)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Ptr_Email)</th>
                                <td>@Html.DisplayFor(model => model.Ptr_Email, new { htmlAttributes = new { @class = "form-control", id = "Ptr_Email" } })</td>
                                <td>@Html.HiddenFor(model => model.Ptr_Email)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h3>Informações do Veículo</h3>
                    <table class="table table-borderless">
                        <tbody>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Vec_Placa)</th>
                                <td>@Html.DisplayFor(model => model.Vec_Placa, new { htmlAttributes = new { @class = "form-control", id = "Vec_Placa" } })</td>
                                <td>@Html.HiddenFor(model => model.Vec_Placa)</td>
                            </tr>

                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Vec_RENAVAN)</th>
                                <td>@Html.DisplayFor(model => model.Vec_RENAVAN, new { htmlAttributes = new { @class = "form-control", id = "Vec_RENAVAN" } })</td>
                                <td>@Html.HiddenFor(model => model.Vec_RENAVAN)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Vec_Ano)</th>
                                <td>@Html.DisplayFor(model => model.Vec_Ano, new { htmlAttributes = new { @class = "form-control", id = "Vec_Ano" } })</td>
                                <td>@Html.HiddenFor(model => model.Vec_Ano)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Vec_Marca)</th>
                                <td>@Html.DisplayFor(model => model.Vec_Marca, new { htmlAttributes = new { @class = "form-control", id = "Vec_Marca" } })</td>
                                <td>@Html.HiddenFor(model => model.Vec_Marca)</td>
                            </tr>
                            <tr></tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h3>Informações da Multa</h3>
                    <table class="table table-borderless">
                        <tbody>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Mut_AIT)</th>
                                <td>@Html.DisplayFor(model => model.Mut_AIT, new { htmlAttributes = new { @class = "form-control", id = "Mut_AIT" } })</td>
                                <td>@Html.HiddenFor(model => model.Mut_AIT)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Mut_CodigoInfracao)</th>
                                <td>@Html.DisplayFor(model => model.Mut_CodigoInfracao, new { htmlAttributes = new { @class = "form-control", id = "Mut_CodigoInfracao" } })</td>
                                <td>@Html.HiddenFor(model => model.Mut_CodigoInfracao)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Mut_DataInfracao)</th>
                                <td>@Html.DisplayFor(model => model.Mut_DataInfracao, new { htmlAttributes = new { @class = "form-control", id = "Mut_DataInfracao" } })</td>
                                <td>@Html.HiddenFor(model => model.Mut_DataInfracao)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Mut_DescricaoInfracao)</th>
                                <td>@Html.DisplayFor(model => model.Mut_DescricaoInfracao, new { htmlAttributes = new { @class = "form-control", id = "Mut_DescricaoInfracao" } })</td>
                                <td>@Html.HiddenFor(model => model.Mut_DescricaoInfracao)</td>
                            </tr>
                            <tr>
                                <th scope="row"> @Html.DisplayNameFor(model => model.Mut_StatusAIT)</th>
                                <td>@Html.DisplayFor(model => model.Mut_StatusAIT, new { htmlAttributes = new { @class = "form-control", id = "Mut_StatusAIT" } })</td>
                                <td>@Html.HiddenFor(model => model.Mut_StatusAIT)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <br>



            <div class="col-md-12">

                <div>
                    <div class="title_box" id="subject">
                        <div id="title" class="text-danger"><strong>INFORMAÇÃO IMPORTANTE</strong> </div>
                        <div id="content">
                            Tenha em mãos toda documentação necessária, pois a abertura do processo é imediata após confirmação dos termos e finalização dos procedimentos.<br />
                            Caso não seja finalizada a abertura do processo, será necessário refazer todo procedimento.<br />
                            A numeração do processo só será gerada após finalização da abertura.<br />
                            Após clicar em “Finalizar Abertura do Processo”, não será mais possível realizar alterações.<br />
                            <br />
                            <label class="pure-material-checkbox">
                                <input type="checkbox" name="ConfirmarChk" , id="ConfirmarChk" onchange="habilitar()">
                                <span>Declaro que li e estou ciente das informações acima.</span>
                            </label>
                        </div>
                    </div>
                </div>

                <br />
                <br />
                <div class="text-center">
                    <button type="button" class="btn btn-primary btn-lg btn-transalvador" id="BtnAvancar" , name="BtnAvancar" @*data-toggle="modal" data-target="#modalConfirmacao"*@>
                        Próximo
                    </button>
                </div>
            </div>
        </div>
    </div>



    <!-- Modal -->

    <div class="modal fade" id="modalConfirmacao" tabindex="-1" role="dialog" aria-labelledby="modalConfirmacao"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="col-md-4" style="padding: 0;">
                <div class="alerta-atencao text-center">
                    <img src="~/img/warning.svg" width="120">
                </div>
            </div>
            <div class="col-md-8" style="padding: 0;">
                <div class="mensagem-modal modal-atencao text-center">
                    <h4>Confirmar Condutor?</h4>
                    <p>Você tem certeza que deseja salvar a indicação? As informações não poderão ser alteradas posteriormente.</p>
                    <div class="col-md-12 modal-footer">
                        <div class="text-center">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" id="ConfirmarDados" name="ConfirmarDados"> Confirmar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}


<script type='text/javascript'>


    document.getElementById('BtnAvancar').setAttribute("disabled", "disabled");


    function habilitar() {
        if (document.getElementById('ConfirmarChk').checked) {
            document.getElementById('BtnAvancar').removeAttribute("disabled");
        }
        else {
            document.getElementById('BtnAvancar').setAttribute("disabled", "disabled");
        }
    }

    //verificar se ja foi realizado o processo para o ait
    $('#BtnAvancar').click(function () {
        posLoad();
        $('#modalConfirmacao').modal('show');
        //colocar na view de confirmação uma verificação para nao processar novamente
    });

    $('#ConfirmarDados').click(function () {
        preLoad();
        var form = $('form')[0];
        var formData = new FormData(form);
       
        $.ajax({
            url: '@Url.Action("procgerarprocesso", "Juridico_ApresentacaoCondutor")',
            type: "POST",
            data: formData,
            dataType: 'json',
            contentType: false,
            processData: false,
   

            success: function (data) {
                posLoad();
                $('#modalConfirmacao').modal('hide');
                if (data.error == true) {
                    posLoad();
                    swal("Ops!", "Houve uma falha de comunicação, por favor tente novamente mais tarde.", "error");
                    $('#Ptr_CPF_CNPJ').focus();
                    $('#Ptr_CPF_CNPJ').val("");
                    return false;
                } else {
                    posLoad();
                    swal("Dados confirmados!", "Procedimento concluido com sucesso.", "success")
                    .then(() => {
                        if (data.isRedirect) {
                           // window.location.href = data.redirectUrl;
                            RedirectUrl(data.redirectUrl, data.mut_ait, data.pro_numero)
                        }
                    });
                }

            },

            error: function () {
                posLoad();
                swal("Ops!", "Houve uma falha de comunicação, por favor tente novamente mais tarde. ", "error")
                .then(() => {
                    location.reload();
                });
            },
        });
    });

    function RedirectUrl(redirectUrl, mut_ait, pro_Numero) {
        var form = $('<form action="' + redirectUrl + '" method="post">' +
            '<input type="hidden" name="mut_ait" value="' + mut_ait + '" />' +
            '<input type="hidden" name="pro_Numero" value="' + pro_Numero + '" />' +
            '</form>');

        $('body').append(form);
        $(form).submit();
    }



</script>